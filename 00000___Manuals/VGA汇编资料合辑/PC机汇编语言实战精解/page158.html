<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第6章 文字输出与键盘输入</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page157.html">上一页</a> <a href="page159.html">下一页</a> <a href="page168.html">下一章</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-158-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>

<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
C:\ASM\>DEBUG[Enter]<br>
-a100[Enter]
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3>
1028:0100<br>
1028:0103<br>
1028:0105<br>
1028:0107<br>
1028:010A<br>
1028:010C<br>
1028:010D<br>
1028:0110<br>
1028:0112<br>
1028:0114<br>
1028:0115<br>
1028:0117<br>
1028:0119<br>
1028:011A<br>
1028:011C
</td>
<td colspan=2>
MOV<br>
MOV<br>
INT<br>
CMP<br>
JZ<br>
INC<br>
MOV<br>
MOV<br>
MOV<br>
OUT<br>
MOV<br>
MOV<br>
OUT<br>
JMP<br>
INT
</td>
<td colspan=5>
BX,0000<br>
AH,00<br>
16<br>
AH,01<br>
011C<br>
BX<br>
DX,03D4<br>
AL,0E<br>
AH,BH<br>
DX,AX<br>
AL,0F<br>
AH,BL<br>
DX,AX<br>
0103<br>
20
</td>
<td colspan=8>
；光标地址清0<br>
；等待键盘输入<br>
<br>
；是"ESC"键吗？<br>
；是"ESC"则转011C结束<br>
；光标地址加1<br>
；DX指向索引寄存器<br>
；CRTC14寄存器的索引号送AL<br>
；光标地址高字节送AH<br>
；将光标地址高字节送CRTC14<br>
；CRTC15寄存器的索引号送AL<br>
；光标地址低字节送AH<br>
；将光标地址低字节送CRTC15<br>
；转0103继续<br>
；结束程序
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　运行这个程序，按下任一键后光标跑到第一行第二列上，此后无论按下哪个键光标都会移动到下一个位置，直至按下Esc后程序结束。这个程序看上去很简单，但它又包含了两个新的知识点：<br>
<font face="楷体_GB2312">
　　（1）当我们使用16H中断的0号功能取得按键后我们并未跟据AL寄存器中的ASCII码来判断按下何键，而采用了AH中的返回数据；<br>
　　（2）在向端口输出数据时，我们也没有采用先由索引端口送出寄存器号，后由数据端口送出数据的标准形式，而是将寄存器号放入AL，将数据放入AH，然后向端口3D4H输出了一个字。这两个新知识点都与AH寄存器有关，我们先来讨论第二点。<br>
</font>
　　还记得我们前面讨论的关于"PTR"操作符的问题吗？访问存储器时我们可以用这个操作符指定访问内存中的一个字节或一个字，其实访问端口也可以指定位宽，我们使用AL寄存器访问端口时只能输出或输入一个字节数据，如果使用AX寄存器访问端口就能输出或输入一个字的数据。例如上面程序中的指令"OUT DX，AX"就是向端口3D4H输出一个字数据。那么这一个字数据究竟送到哪儿去了？<br>
　　从上面这个程序执行的结果来看我们可以猜测出AL寄存器中的数据应该送至端口3D4H，而AH中的数据应该送至端口3D5H，这才可能出现光标移动的结果。这个猜测的确是对的，输出数据的低字节送到了DX寄存器指定的端口，而高字节送到了端口DX＋1处。这一点和访问内存时的情况一样，指令"MOV [BX]，AX"执行时同样会将AL中的数据送至[BX]处，而将AH中的数据送至[BX+1]处。我们前面曾经说过端口也是一些存储单元，它具有内部寄存器和存储器双重的特性，学习到这里你应该对这个说法有了充分的理解。不过有一点特殊的地方我必须说明，那就是16位数据只能从偶数地址端口输出或输入，而不能从奇数地址端口输出或输入字数据，这一点是和访问内存不一样的。<br>
　　说了这么多的东西，这一节的内容到此就可以结束了。一般来说我们不提倡通过端口控制显示卡的工作，因为这会使程序的可移植性变坏。这是有先例的，CCDOS2.1版就是因为这个原因无法在EGA/VGA卡上运行。所以除非特殊需要，我们应尽量使用BIOS完成对显示卡的控制，使用直接写屏的方法完成显示操作，这样就可以兼顾效率与可移植性两个方面。
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page157.html">上一页</a> <a href="page159.html">下一页</a> <a href="page168.html">下一章</a></p>
</body>
</html>
