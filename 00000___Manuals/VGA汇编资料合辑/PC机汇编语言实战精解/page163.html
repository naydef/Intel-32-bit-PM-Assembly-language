<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第6章 文字输出与键盘输入</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page162.html">上一页</a> <a href="page164.html">下一页</a> <a href="page168.html">下一章</a></p>
<table border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td> <!左侧空白>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td> <!右侧空白>
</tr>

<!页眉行>
<tr height=60 valign="bottom">
<td></td><td></td><td></td>
<td colspan=6><img src="icons/flag.gif"></td><td colspan=4></td><td colspan=6 align="right">第6章 文字输出与键盘输入</td> <!章节名>
<td></td><td>-163-</td><td></td> <!页码>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18 align=center><img src="figures/F6_11.gif"><br><font face="楷体_GB2312">图6-11 键盘缓冲区动态示意图</font></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　当应用程序使用16H中断的0号功能取得按键时，16H中断服务程序就会取得队列首指针和尾指针并比较这两个指针，如果首指针和尾指针不相等，说明键盘缓冲区中有数据，这时16H中断服务程序就会从首指针指向的内存单元中取出扫描码和ASCII码并放入累加器中，然后将首指针加2重新保存在001AH处，最后将AX中的数据返回给应用程序。此时键盘缓冲区的情况如图6-11（c）所示，我们可以看到缓冲区头部空出了两个字节。<br>
　　如果应用程序连续3次读取按键，那么缓冲区首部就会空出6个字节的空间；这个时候我们继续按键，那么键盘中断就会将数据保存到缓冲区首部，最终键盘缓冲区变成了图6-11（d）所示的情况；可见后面进入缓冲区的数据反而存入了缓冲区前面，这便是所谓的"循环队列"，也称为"环形缓冲区"。<br>
　　由于16H中断总是从首指针指向的内存单元中取数据，所以键盘缓冲区具有"先入先出"的性质，这和堆栈的性质正相反。队列首指针由16H中断控制，队列尾指针由09H中断控制，这两个指针绕着圈相互追赶，若尾指针追上首指针则说明缓冲区满，而首指针追上尾指针则说明缓冲区变空。我们从DEBUG显示的信息可以看到首尾指针都指向003CH，说明此时缓冲区是空的。如果我们人为地改变尾指针指向那又会有什么情况发生呢？
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
C:\ASM\>DEBUG[Enter]<br>
-a100[Enter]
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3>
15E1:0100<br>
15E1:0103<br>
15E1:0105<br>
15E1:010B<br>
15E1:010E<br>
15E1:0112<br>
15E1:0117<br>
15E1:011A<br>
15E1:011E
</td>
<td colspan=2>
MOV<br>
MOV<br>
MOV<br>
MOV<br>
MOV<br>
MOV<br>
ADD<br>
MOV<br>
INT
</td>
<td colspan=5>
AX,0040<br>
DS,AX<br>
WORD PTR [001A],001E<br>
BX,001E<br>
WORD PTR [BX],1372<br>
WORD PTR [BX+02],1C0D<br>
BX,04<br>
[001C],BX<br>
20
</td>
<td colspan=8>
；初始化DS寄存器指向BIOS数据区<br>
<br>
；键盘缓冲区首指针指向缓冲区首<br>
；BX寄存器指向缓冲区首<br>
；键盘缓冲区内置入"r"<br>
；"r"之后置入回车符<br>
；计算键盘缓冲区尾指针<br>
；保存键盘缓冲区尾指针<br>
；结束程序
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
-g=100[Enter]<br>
Program terminated normally
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>-r</td><td colspan=16><font face="楷体_GB2312" size=2>这个r并非通过键盘敲入</font></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>AX=0000</td><td colspan=2>BX=0000</td><td colspan=2>CX=0000</td><td colspan=2>DX=0000</td><td colspan=2>SP=FFEE</td><td colspan=2>BP=0000</td><td colspan=2>SI=0000</td><td colspan=2>DI=0000</td><td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>DS=15E1</td><td colspan=2>ES=15E1</td><td colspan=2>SS=15E1</td><td colspan=2>CS=15E1</td><td colspan=2>IP=0100</td>
<td colspan=5>NV UP EI PL NZ NA PO NC</td><td colspan=3></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>15E1:0100</td><td colspan=2>B84000</td><td colspan=6>MOV AX,0040</td>
<td colspan=8></td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page162.html">上一页</a> <a href="page164.html">下一页</a> <a href="page168.html">下一章</a></p>
</body>
</html>
