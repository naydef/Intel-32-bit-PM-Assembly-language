<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第7章 文件控制块</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page171.html">上一页</a> <a href="page173.html">下一页</a> <a href="page207.html">下一章</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-172-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>

<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18 align=center><img src="figures/F7_3.gif"><br><font face="楷体_GB2312">图7-3 记录块与记录</font></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　由字节构成记录，由记录构成记录块，由记录块最终构成了文件。这里面有这样两个问题：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18 align=center>
（1）一个记录块包含多少个记录？（2）每个记录包含多少个字节？
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　问题很简单，DOS规定每个记录块包含128个记录，而每个记录的长度则要由文件控制块中偏移0EH处的两字节数据规定。这个长度可以由我们自己根据需要而确定，如果我们没有明确指定记录长度，那么DOS会给出一个默认长度，值为128字节。此时我们可以算出一个记录块的长度是128×128＝16384字节。<br>
　　由于DOS对文件的长度是有限制的（〈230字节），所以如果我们使用默认的记录长度，那么一个文件的记录块数最多可有65536个，这恰好可以用一个字的数据表示，这个字在FCB偏移0CH处。<br>
　　这个数据和偏移0EH处的记录长度配合使用就可以使我们得以访问文件中的任意数据，我们把利用这两个数据访问文件的方法称为"顺序访问"。<br>
　　在FCB的最后还有4字节的数据，位于偏移21H处，这4个字节指出了"相对记录号"，利用"相对记录号"也能完成文件读写，我们把这种处理方法称为"随机访问"。<br>
　　综合上述，我们可以看到FCB中真正属性我们的数据只占一部分，从偏移-1至偏移16共有17个字节可由我们控制，还有就是FCB最后4个字节，其余的都由DOS进行处理。<br>
　　下面我们给出了一个普通FCB的实例，利用这个FCB我们可以对C盘上的CONFIG.SYS文件进行处理。
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
DATA<br>
<br>
MY_FCB<br>
DRIVE<br>
FILE_NAME<br>
EXT_NAME<br>
CUR_BLOCK<br>
REC_SIZE<br>
FILE_SIZE<br>
CREA_DATE<br>
POSITION<br>
CUR_REC<br>
REL_REC<br>
DATA
</td>
<td colspan=2>
SEGMENT<br>
ASSUME<br>
LABEL<br>
DB<br>
DB<br>
DB<br>
DW<br>
DW<br>
DW<br>
DW<br>
DB<br>
DB<br>
DW<br>
ENDS
</td>
<td colspan=5>
<br>
DS:DATA<br>
BYTE<br>
0<br>
'CONFIG  '<br>
'SYS'<br>
?<br>
?<br>
2 DUP(?)<br>
?<br>
10 DUP(?)<br>
?<br>
2 DUP(?)<br>
<br>
</td>
<td colspan=9>
<br>
<br>
<br>
；驱动器号，0：当前  1：A  2：B  ...<br>
；文件名<br>
；扩展名<br>
；当前记录块号<br>
；记录长度<br>
；文件长度，由系统填入<br>
；建立或最后修改的日期，由系统填入<br>
；保留空间，由系统填入<br>
；当前记录号<br>
；相对记录号<br>
<br>
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page171.html">上一页</a> <a href="page173.html">下一页</a> <a href="page207.html">下一章</a></p>
</body>
</html>
