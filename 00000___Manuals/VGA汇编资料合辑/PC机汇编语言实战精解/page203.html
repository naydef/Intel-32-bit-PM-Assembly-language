<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第7章 文件控制块</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page202.html">上一页</a> <a href="page204.html">下一页</a> <a href="page207.html">下一章</a></p>
<table border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td> <!左侧空白>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td> <!右侧空白>
</tr>

<!页眉行>
<tr height=60 valign="bottom">
<td></td><td></td><td></td>
<td colspan=6><img src="icons/flag.gif"></td><td colspan=4></td><td colspan=6 align="right">第7章 文件控制块</td> <!章节名>
<td></td><td>-203-</td><td></td> <!页码>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　笔者使用了"TASM.EXE"这个程序作为"调试"对象，其实可以选择任意一个".EXE"的文件。现在请大家回想一下当一个".EXE"文件被DEBUG调入后，段寄存器DS和ES指向谁所在的段？<br>
　　段寄存器DS和ES指向"PSP"所在的段。我们现在就来看一看PSP中还有什么有用的数据：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>-d0[Enter]</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0000</td><td colspan=10>CD 20 FF 9F 00 9A F0 FE-1D F0 4F 03 92 09 8A 03</td><td></td><td colspan=5>. ........O.....</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0010</td><td colspan=10>92 09 17 03 92 09 81 09-01 04 01 00 02 FF FF FF</td><td></td><td colspan=5>................</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0020</td><td colspan=10>FF FF FF FF FF FF FF FF-FF FF FF FF 18 10 4C 01</td><td></td><td colspan=5>..............L.</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0030</td><td colspan=10>97 0D 14 00 18 00 27 10-FF FF FF FF 00 00 00 00</td><td></td><td colspan=5>......'.........</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0040</td><td colspan=10>07 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00</td><td></td><td colspan=5>................</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0050</td><td colspan=10>CD 21 CB 00 00 00 00 00-00 00 00 00 00 <u>41 41 41</u></td><td></td><td colspan=5>.!...........<u>AAA</u></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0060</td><td colspan=10>20 20 20 20 20 20 20 20-00 00 00 00 00 <u>42 42 42</u></td><td></td><td colspan=5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.....<u>BBB</u></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1027:0070</td><td colspan=10>20 20 20 20 20 20 20 20-00 00 00 00 00 00 00 00</td><td></td><td colspan=5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;........</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　"金矿"并不难发现，注意PSP中偏移5CH和偏移6CH处的数据，我们给"TASM.EXE"的两个参数"aaa"和"bbb"就在其中。我们由此得出了第一个结论：程序所需的两个参数出现在PSP偏移5CH和6CH处，而且是以大写形式出现的。<br>
　　通过这个实验我们也能发觉三个问题：第一，PSP偏移5CH和6CH处存放的数据都是"0"，并不是真正的命令行参数，为什么要说参数出现在偏移5CH和6CH处呢？如果这个"0"是参数的一部分的话，那么它又有什么含义？第二，如果有更多的参数会有什么情况？第三，如果有开关符"/"又会有什么情况？为搞清这三个问题，我们再做三次实验。先看看那个奇怪的"0"是怎么回事，注意命令中加有下划线的内容：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>C:\ASM\>debug tasm.exe a:xxx c:yyy[Enter]</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=18>-d0[Enter]</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0000</td><td colspan=10>CD 20 FF 9F 00 9A F0 FE-1D F0 4F 03 92 09 8A 03</td><td></td><td colspan=5>. ........O.....</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0010</td><td colspan=10>92 09 17 03 92 09 81 09-01 04 01 00 02 FF FF FF</td><td></td><td colspan=5>................</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0020</td><td colspan=10>FF FF FF FF FF FF FF FF-FF FF FF FF 18 10 4C 01</td><td></td><td colspan=5>..............L.</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0030</td><td colspan=10>97 0D 14 00 18 00 27 10-FF FF FF FF 00 00 00 00</td><td></td><td colspan=5>......'.........</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0040</td><td colspan=10>07 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00</td><td></td><td colspan=5>................</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0050</td><td colspan=10>CD 21 CB 00 00 00 00 00-00 00 00 00 <u>01</u> 58 58 58</td><td></td><td colspan=5>.!...........xxx</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0060</td><td colspan=10>20 20 20 20 20 20 20 20-00 00 00 00 <u>03</u> 59 59 59</td><td></td><td colspan=5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.....yyy</td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>1028:0070</td><td colspan=10>20 20 20 20 20 20 20 20-00 00 00 00 00 00 00 00</td><td></td><td colspan=5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;........</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　问题清楚了，偏移5CH和6CH处存放的数据原来是驱动器号，我们做第一次实验时没有指定驱动器，所以DOS给我们填入了"默认"驱动器号。这个问题就有些奇怪了，难道DOS会把我们给出的参数都当做文件名来处理吗？说到此，笔者认为已经到了真正搞清这两个数据结构的时候了。<br>
　　在PSP偏移5CH和6CH处有两个DOS提供给我们的十分重要的数据结构，这两个数据结构我们称之为"格式化未打开的FCB"。实际上每一个FCB的长度只有16个字节，其结构与一般的FCB相同。注意这两个FCB都是"未打开的"，如果我们将第一个FCB打开了，那么第二个FCB就会被覆盖。
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page202.html">上一页</a> <a href="page204.html">下一页</a> <a href="page207.html">下一章</a></p>
</body>
</html>
