<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第8章 文件句柄功能与磁盘</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page214.html">上一页</a> <a href="page216.html">下一页</a> <a href="page238.html">下一章</a></p>
<table border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td> <!左侧空白>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td> <!右侧空白>
</tr>

<!页眉行>
<tr height=60 valign="bottom">
<td></td><td></td><td></td>
<td colspan=6><img src="icons/flag.gif"></td><td colspan=4></td><td colspan=6 align="right">第8章 文件句柄功能与磁盘</td> <!章节名>
<td></td><td>-215-</td><td></td> <!页码>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
abord:<br>
<br>
<br>
<br>
exit:<br>
<br>
<br>
main<br>
code<br>
<br>
</td>
<td colspan=2>
int<br>
jc<br>
<br>
cmp<br>
jz<br>
<br>
mov<br>
mov<br>
int<br>
mov<br>
int<br>
<br>
mov<br>
mov<br>
int<br>
jmp<br>
<br>
mov<br>
mov<br>
int<br>
<br>
mov<br>
int<br>
endp<br>
ends<br>
end
</td>
<td colspan=5>
21h<br>
abord<br>
<br>
cx,32<br>
dup_loop<br>
<br>
ah,3eh<br>
bx,handle1<br>
21h<br>
bx,handle2<br>
21h<br>
<br>
dx,offset msg2<br>
ah,9<br>
21h<br>
exit<br>
<br>
dx,offset msg1<br>
ah,9<br>
21h<br>
<br>
ah,4ch<br>
21h<br>
<br>
<br>
main
</td>
<td colspan=9>
<br>
；若数据未能正确写入文件，转ABORD<br>
<br>
；处理的数据够32个字节吗？<br>
；若处理的数据够32字节，转DUP_LOOP继续<br>
<br>
；关闭源文件<br>
<br>
<br>
；关闭目标文件<br>
<br>
<br>
；显示字符串MSG2<br>
<br>
<br>
；转EXIT结束进程<br>
<br>
；输出字符串MSG1<br>
<br>
<br>
<br>
；结束进程<br>
<br>
<br>
<br>
<br>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　通过这个程序我们可以看到写入功能40H的调用方法与3FH功能大同小异。这个程序每次处理32字节数据，依据DOS在AX寄存器返回的字节数判断是否处理完所有数据。它还演示了3CH功能的用法，除此之外没有什么更多特殊的地方。当然，有一点还要提醒大家，那就是不要忘记使用3EH功能关闭文件确实保证数据存入磁盘。<br>
　　我们的学习好象变得越来越平淡了，新问题似乎变得少了，可能这就是一般所说的"书越念越浅"吧。实际上我所要讲解的东西也确实是越来越少，大家通过这一段的学习，对汇编语言的特点和学习方法已有了一定的了解，很多问题不用我说大家自然知道如何应用DEBUG之类的工具软件去分析研究。当然，概念性的内容还是要仔细讨论的，比如程序TYPEFILE.ASM所反映出的问题：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
TYPEFILE.ASM<br>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
HANDLE2<br>
data<br>
<br>
fname1
</td>
<td colspan=2>
equ<br>
segment<br>
assume<br>
db
</td>
<td colspan=5>
02h<br>
<br>
ds:data<br>
'config.txt',0
</td>
<td colspan=9>
<br>
<br>
<br>
；将处理的文件名
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page214.html">上一页</a> <a href="page216.html">下一页</a> <a href="page238.html">下一章</a></p>
</body>
</html>
