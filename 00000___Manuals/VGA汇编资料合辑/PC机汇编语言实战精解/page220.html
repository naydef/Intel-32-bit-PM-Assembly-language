<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第8章 文件句柄功能与磁盘</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page219.html">上一页</a> <a href="page221.html">下一页</a> <a href="page238.html">下一章</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-220-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
向了第三个字节，所以当程序第二次调用3FH功能读入数据时，我们实际读取的是文件的第三个字节，这个字节随后又被写入文件的第四个字节处。可以看出，由于读、写功能交替修改文件读写指针，使得程序每次读入奇数位置的字符并将其写入偶数位置，因而使"[MENU]"变成了"[[EEUU"。<br>
　　以上就是"文件读写指针"在文件处理过程中所起的作用，由于它是起一个"定位"的作用，所以人为修改这个数据使其指向文件中的任意一个位置，我们就能存取从相应位置开始的数据。现在的问题就是如何才能修改这个数据？<br>
　　DOS为我们提供了一个功能调用专用于修改文件读写指针，表7-1中包括了这个功能，下面给出这个功能更详细的说明：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3 align="center"><img src="icons/note.gif"></td>
<td colspan=15>
功能号：42H<br>
用　途：移动文件读写指针<br>
参　数：BX--文件句柄<br>
　　　　CX--偏移值的高16位；DX--偏移值的低16位<br>
　　　　AL--方式代码<br>
　　　　　　00H--偏移量从文件头开始（绝对移动）<br>
　　　　　　01H--偏移量从当前位置开始（相对机动）<br>
　　　　　　02H--偏移量从文件尾开始（绝对倒移）<br>
调　用：INT 21H<br>
返　回：如果成功，CF标志置0，DX:AX--文件读写指针所指向的新位置；<br>
　　　　如果失败，CF标志置1，AX--错误代码
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　有一点很关键的地方就是CX:DX寄存器中所设置的32位数据究竟是何含义？我们说随AL寄存器中的方式代码不同，CX:DX寄存器中的数据含义也有区别。当AL寄存器中的方式代码为00H时，CX:DX代表了从文件"头部"开始的偏移位置。比如CX寄存器为0，DX寄存器为0020H，这时用42H功能就可以使文件读写指针指向文件中的第32个字节处；当AL寄存器中的方式代码为01H时，CX:DX代表了从"当前"位置开始的偏移量。还以CX＝0，DX＝0020H为例，若当前文件读写指针正指向文件偏移0020H处，此时用方式1移动文件指针时DOS会将文件读写指针"增加"20H，使其指向距离文件首部64字节处。可见在文件读写指针为0的情况下方式0与1有相同的效果。至于方式3，CX:DX代表的是距文件尾部的偏移量。为了搞清楚这个问题，我们来看下面两个程序：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>STARMAP.ASM</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
data<br>
<br>
fname<br>
buffer<br>
off<br>
msg<br>
data<br>
<br>
code<br>
<br>
</td>
<td colspan=2>
segment<br>
assume<br>
db<br>
db<br>
dw<br>
db<br>
ends<br>
<br>
segment<br>
assume
</td>
<td colspan=14>
<br>
ds:data<br>
'hzk16',0<br>
32 dup(0)<br>
1520h,0002h,3340h,0001h,18e0h,0000h,74a0h,0002h,2520h,0001h<br>
'Press any key to display the next star-map.',0dh,0ah,24h<br>
<br>
<br>
<br>
cs:code
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page219.html">上一页</a> <a href="page221.html">下一页</a> <a href="page238.html">下一章</a></p>
</body>
</html>
