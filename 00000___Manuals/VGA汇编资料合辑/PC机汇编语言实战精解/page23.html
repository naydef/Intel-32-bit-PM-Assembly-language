<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第2章 开始设计程序</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page22.html">上一页</a> <a href="page24.html">下一页</a> <a href="page27.html">下一章</a></p>
<table border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td> <!左侧空白>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td> <!右侧空白>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td></td><td></td>
<td colspan=6><img src="icons/flag.gif"></td><td colspan=4></td><td colspan=6 align="right">第2章 开始设计程序</td> <!章节名>
<td></td><td>-23-</td><td></td> <!页码>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>-t</td><td colspan=6></td><td colspan=10><font face="楷体_GB2312" size="2">SP寄存器继续减量</font></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>AX=1234</td><td colspan=2>BX=ABCD</td><td colspan=2>CX=000A</td><td colspan=2>DX=0000</td><td colspan=2>SP=FFEA</td><td colspan=2>BP=0000</td><td colspan=2>SI=0000</td><td colspan=2>DI=0000</td><td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>DS=0B01</td><td colspan=2>ES=0B01</td><td colspan=2>SS=0B01</td><td colspan=2>CS=0B01</td><td colspan=2>IP=0108</td>
<td colspan=5>NV UP EI PL NZ NA PO NC</td><td colspan=3></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>0B01:0108</td><td colspan=2>58</td><td colspan=6 align="center">POP AX</td><td colspan=6><font face="楷体_GB2312" size="2">POP指令执行与PUSH恰好相反</font></td>
<td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　执行了"PUSH  BX"之后SP寄存器继续减2。
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>-t</td><td colspan=6><font face="楷体_GB2312" size="2">注意AX寄存器的改变</font></td><td colspan=10><font face="楷体_GB2312" size="2">执行POP指令后SP寄存器增量</font></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>AX=ABCD</td><td colspan=2>BX=ABCD</td><td colspan=2>CX=000A</td><td colspan=2>DX=0000</td><td colspan=2>SP=FFEC</td><td colspan=2>BP=0000</td><td colspan=2>SI=0000</td><td colspan=2>DI=0000</td><td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>DS=0B01</td><td colspan=2>ES=0B01</td><td colspan=2>SS=0B01</td><td colspan=2>CS=0B01</td><td colspan=2>IP=0109</td>
<td colspan=5>NV UP EI PL NZ NA PO NC</td><td colspan=3></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>0B01:0109</td><td colspan=2>5B</td><td colspan=6 align="center">POP BX</td><td colspan=4></td>
<td colspan=4></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　现在指令"POP  AX"执行完华，注意SP寄存器的变化，它加了2。另外看一看AX寄存器与BX的关系，究竟那个数从堆栈中跳出了呢？
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>-t</td><td colspan=6><font face="楷体_GB2312" size="2">AX、BX寄存器内容交换</font></td><td colspan=10><font face="楷体_GB2312" size="2">SP寄存器复员</font></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>AX=ABCD</td><td colspan=2>BX=1234</td><td colspan=2>CX=000A</td><td colspan=2>DX=0000</td><td colspan=2>SP=FFEE</td><td colspan=2>BP=0000</td><td colspan=2>SI=0000</td><td colspan=2>DI=0000</td><td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>DS=0B01</td><td colspan=2>ES=0B01</td><td colspan=2>SS=0B01</td><td colspan=2>CS=0B01</td><td colspan=2>IP=010A</td>
<td colspan=5>NV UP EI PL NZ NA PO NC</td><td colspan=3></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>0B01:010A</td><td colspan=2>0883745B</td><td colspan=6 align="center">OR [BP+DI+5B74],AL</td><td colspan=4></td>
<td colspan=4></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　最后一条指令"POP  BX"执行完了，我们可以很清楚地看到SP寄存器的变化情况，同时也会发现，AX寄存器和BX寄存器中的数据换了位置，这就是堆栈中数据"后进先出"的结果。<br>
　　应用PUSH和POP指令时必须记住使用16位数据，PUSH  AH、POP  DL这样的用法都是不对的。<br>
　　新增了两条指令，"救活"了一个循环，现在这个程序应该可以结束了吧？不过现在的回答仍然是否定的。<br>
　　很多高级语言都不要求程序结尾必须有表示结束的语句，然而汇编语言可不行。除非你输入了要求返回DOS的指令，否则CPU是不会自行结束执行程序的。因此我们需要再学一条指令：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3 align="center"><img src="icons/note.gif"></td>
<td colspan=8>
助记符：RET（Return）<br>
用　途：从子程序返回到主程序<br>
格　式：RET<br>
执　行：结束子程序的执行，返回主程序<br>
</td>
<td rowspan=2></td>
<td rowspan=2 colspan=6>
PROG2<br>
0B1D:0100 MOV CX,0800<br>
0B1D:0103 PUSH CX<br>
0B1D:0104 IN AL,61<br>
0B1D:0106 XOR AL,02<br>
0B1D:0108 OUT 61,AL<br>
0B1D:010A MOV CX,0500<br>
0B1D:010D LOOP 010D<br>
0B1D:010F POP CX<br>
0B1D:0110 LOOP 0103<br>
0B1D:0112 RET
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=11>
　　关于这条指令的使用还有很多更深入的内容，但凭我们现在这点功底还不宜讲得过深，现在只需记住这条指令能够让我们的程序正常的结束就行了。PROG2就是程序最终改成的样子。<br>
　　运行PROG2，喇叭里会发出一声鸣叫，然后屏幕上会重新出现DEBUG的提示符。改变外循环的计数值，就可以任意改变声音的长短。
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　-g=100<br>
　　Program terminated normally（程序正常结束）<br>
　　这个程序看来已经接近完美了，然而新的问题又出现了：想要听到0.5秒钟的声音，外循
</td>
<td></td><td></td> <!右边距>
</tr>

</font>
<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page22.html">上一页</a> <a href="page24.html">下一页</a> <a href="page27.html">下一章</a></p>
</body>
</html>

