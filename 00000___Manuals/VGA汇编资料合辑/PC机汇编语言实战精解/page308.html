<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第11章 更高级的技术</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page307.html">上一页</a> <a href="page309.html">下一页</a> <a href="page328.html">附录A</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-308-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
<br>
<br>
<br>
main<br>
code<br>
<br>
</td>
<td colspan=2>
int<br>
<br>
ret<br>
endp<br>
ends<br>
end
</td>
<td colspan=5>
21h<br>
<br>
<br>
<br>
<br>
main
</td>
<td colspan=9>
<br>
<br>
；结束进程<br>
<br>
<br>
<br>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　程序看上去很简单，只是普通地用DB伪指令在数据段内开辟一个32KB的缓冲区。实际上这个程序编译连接成可执行文件后就会曝露出一个问题：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18 align=center><img src="figures/F11_4.gif"></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　所谓的问题就是这个EXE文件好象有点太大了，竟然有30多KB，而源程序中的代码并不多，无非是显示一个字符串而已。这30多KB又从何而来呢？<br>
　　如果去掉源程序中"BUFFER DB..."一行再进行编译连接，那么生成的EXE文件长度会迅速缩短到1KB多。实际上用DB伪指令开辟的缓冲区最终要包含在EXE文件里，每多"DB"一个字节，则最终的EXE文件就要增加一个字节。看来如果程序需要很大的缓冲区，采用传统的程序设计方法会显著增加可执行文件的长度。<br>
　　如何解决这个问题？我们知道"操作系统"的一个重要特征就是可以对各种"资源"进行有效地管理。这里的"资源"指得是各种数据（文件）及系统安装的各类设备。毫无疑问内存也属于设备，它也应该受到操作系统很好地管理。<br>
　　我们现在所依靠的操作系统--DOS就具备管理内存的能力。应用程序可以通过系统功能调用向DOS申请一些内存，结束之前还可以通过系统功能把"借"来的内存"还"给DOS，从而可以不用DB伪指令在数据段里定义缓冲区。<br>
　　48H功能就是DOS提供的用于申请内存的功能调用：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3 align="center"><img src="icons/note.gif"></td>
<td colspan=15>
功能号：48H<br>
用　途：向DOS申请一定量连续内存空间<br>
参　数：AH=48H<br>
　　　　BX=申请内存的"节"数<br>
调　用：INT 21H<br>
返　回：如果成功，则CF清零，AX=申请到的内存块段地址<br>
　　　　如果失败，则CF置1，AX=错误代码，BX=当前内存最大可用块的大小<br>
　　　　AX=07H 内存控制块被破坏<br>
　　　　　 08H 内存不够
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page307.html">上一页</a> <a href="page309.html">下一页</a> <a href="page328.html">附录A</a></p>
</body>
</html>
