<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第4章 奇妙的声音</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page45.html">上一页</a> <a href="page47.html">下一页</a> <a href="page80.html">下一章</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-46-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>

<!正文>
<font face="宋体" lang="ZH-CN" size=3>

<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　此电路用在这里相当一个"可控开关"，如果将61H端口的bit0、bit1位都置成1，则相当于既打开了定时器又打开了开关，这时候定时器产生的声音信号就会送到放大器推动喇叭发声；若将bit0位置0，则定时器关闭，此时OUT端为1，这时候如果连续改变bit1位的状态，也可以从喇叭中听到声音，这就是我们在第二章中所用的方法；若将bit1位置0，则开关关闭，此时即使打开定时器也不能听到声音。<br>
　　这一点可以通过DEBUG加以验证：进入DEBUG，在"－"后打入"O61 3"，即可听到喇叭发出连续的叫声。
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3 align="center"><img src="icons/attention.gif"></td>
<td colspan=15><font face="楷体_GB2312">
O（OUT）命令用于直接向端口输出数据，使用很简单：O端口号  数值。和O命令相对的是I（IN）命令，I命令用于从端口取数据并显示在屏幕上，使用方法：I端口号。
</font></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　向61H端口输出"03"，相当于打开定时器和开关，此时将有连续的声音发出，这个声音的频率约是896Hz，和我们刚开机时听到的蜂鸣音频率一样。<br>
　　有趣的是声音一旦发出就不会停止，而且不干扰用户的任何操作，用户可以退出DEBUG去"DIR"或"FORMAT A:"，声音决不会停止也不会使机器速度变慢。<br>
　　停止这种声音的唯一方法就是进入DEBUG，打入命令"O61 0（也可以是1或2）"。之所以有这种现象是因为定时器的工作并不需CPU直接参与，CPU只要给定时设定好工作状态和频率值并打开定时器，此时定时器就会自主工作，CPU即可去做别的事情。这个特性十分有用，它是实现"背景音乐"的前提。<br>
　　那么如何改变声音的频率呢？请注意定时器的通道3还有一个输入端CLK，这一端输入了一个固定的信号，频率是1193181.6Hz。输出信号与此信号具有如下关系：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=6><hr></td><td colspan=6 align="center"><font size=5>F(OUT)=F(CLK)/N</font></td><td colspan=6><hr></td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　其中N是一个16bit数据，它的值可以由程序设定。方法很简单：将此16位数据分成高、低两个8位，先把低8位送至42H端口，紧接着再把高8位送至42H端口，输出信号的频率就会改变。我们可以试一下：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=6>C:\ASM\>DEBUG[Enter]</td>
<td colspan=12 rowspan=4>
　　设定新的N值是300H，对应的F（OUT）是1193191.6/300H＝1553Hz。声音马上变尖了。<br>
　　有一点必须说明，定时器具有多种工作状态，并非每种工作状态都能产生声音，所以当我们想通过定时器产生声音时，我们应首先"初始化"定时器，为其建立正确的工作状态。初始
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=6>-O61 3[Enter]</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=6>-O42 0[Enter]</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=6>-O42 3[Enter]</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　化定时器并不复杂，向端口43H输出数据0B6H即可。这个数据的二进制形式是10110110，有些书籍把这个数称为"幻数"（MAGIC BYTE）。用这样一个数的原因笔者不作过多讨论，大家可以查阅别的参考书。<br>
　　有了上面介绍的这些知识，我们就可以编程控制定时器发出给定频率的声音。程序PROG6可以使喇叭发出1000Hz的声音，这个程序中有一个新的逻辑操作指令：
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=3 align="center"><img src="icons/note.gif"></td>
<td colspan=15>
助记符：OR（or）<br>
用　途：将两个数据作"或"逻辑操作<br>
格　式：OR  寄存器，立即数<br>
　　　　OR  寄存器，寄存器<br>
　　　　OR  寄存器，存储器<br>
　　　　OR  存储单元，寄存器<br>
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page45.html">上一页</a> <a href="page47.html">下一页</a> <a href="page80.html">下一章</a></p>
</body>
</html>

