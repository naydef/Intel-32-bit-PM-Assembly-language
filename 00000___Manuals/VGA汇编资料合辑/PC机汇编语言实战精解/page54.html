<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第4章 奇妙的声音</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page53.html">上一页</a> <a href="page55.html">下一页</a> <a href="page80.html">下一章</a></p>
<table 	border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td>
</tr>
<!页眉行>
<tr height=60 valign="bottom">
<td></td><td>-54-</td><td></td> <!页码>
<td colspan=6>PC机汇编语言实战精解</td><td colspan=4></td><td colspan=6 align="right"><img src="icons/flag.gif"></td> <!书名>
<td></td><td></td><td></td> <!右侧空白>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>

<!正文>
<font face="宋体" lang="ZH-CN" size=3>

<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
与段寄存器的联系，有了这个伪指令，编译程序就知道了在程序中引用某段中的数据时应该用哪个段寄存器给出段地址。<br>
　　在数据段中我们使用了"DB"伪指令定义的一个字符串，字符串前面的"MESS"是一个"标号"，它表示这个字符串的地址。标号可以是除汇编语言保留字外的任何字串，但不能以数字打头。标号有时也用于代码中，表示其后指令的地址，这样一来当我们用JMP、JZ等转移指令时就可以不必关心具体的目的地址了。<br>
　　数据段结束也使用ENDS伪指令，具体形式同代码段一样。<br>
　　"#3"部分定义了一个代码段，并用"ASSUME"伪指令说明了与其关联的段寄存器。<br>
　　这里有个很重要的问题要提醒大家，虽然在源程序中可以把数据与代码分别安排在两个段内，但这并不意味着在编译成的可执行文件里数据与代码仍然分成两个段。实际上源程序中分段的概念与内存的分段是有些区别的，因为源程序中的段定义还可以加入"定位类型"、"组合类型"之类信息，这些内容在刚刚给出的这个程序中没有体现。有关这一部分内容将在本书最后一章进行说明。<br>
　　"#4"部分是一个具有"NEAR"属性的过程，它是这个程序的核心，作用是使定时器发声。在这个过程中我们使用了前面定义的常量PORT＿B来代替以前用的数字61H。SOUND是这个过程的名字，它实际上也表示了这个过程的起始地址。这样在主过程中用CALL指令调用这个子过程时就不必给出具体的地址了，只需引用这个过程名就行了。这同DEBUG相比是个不小的优点。<br>
　　从"#5"部分开始就是这个程序的主过程，"#6"、"#7"部分看上去好象多余，其实不然。由于主过程具有"FAR"属性，因此主过程结束时的RET指令将被编译程序译成"RETF"远程返回指令。我们之所以事先在堆栈中设定返回地址为DS：0是为了能正确结束程序并返回DOS。那么DS：0处究竟有什么奥秘呢？用DEBUG分析一下这个程序就清楚了。
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
C:\ASM\>DEBUG PROG7-A.EXE[Enter]
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2>-r</td><td colspan=16></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>AX=0000</td><td colspan=2>BX=0000</td><td colspan=2>CX=0052</td><td colspan=2>DX=0000</td><td colspan=2>SP=0000</td><td colspan=2>BP=0000</td><td colspan=2>SI=0000</td><td colspan=2>DI=0000</td><td colspan=2></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>DS=0A3F</td><td colspan=2>ES=0A3F</td><td colspan=2>SS=0A4F</td><td colspan=2>CS=0A51</td><td colspan=2>IP=0102</td>
<td colspan=5>NV UP EI PL NZ NA PO NC</td><td colspan=3></td>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>0A51:0014</td><td colspan=2>1E</td><td colspan=6 align="center">PUSH DS</td><td colspan=4><font face="楷体_GB2312" size=2>注意IP寄存器的指向</font></td>
<td colspan=4></td>
<td></td><td></td> <!右边距>
</tr>


<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
<font face="楷体_GB2312" size=2>用R命令列出寄存器后就会发现DS寄存器和CS的值不一样。</font>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
-uds:0 6[Enter]<br>
<td></td><td></td> <!右边距>
</tr>
<tr>
<td></td><td></td> <!左边距>
<td colspan=2>
0A3F:0000<br>
0A3F:0002<br>
0A3F:0006<br>
</td>
<td colspan=2>
CD20<br>
FF9F009A<br>
F0<br>
</td>
<td colspan=2>
INT<br>
CALL FAR<br>
LOCK<br>
</td>
<td colspan=12>
20<br>
[BX+9A00]<br>
<br>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　又是"INT 20"。大家是不是又看到一些似曾相识的数据呢？<br>
　　事实上，无论是"COM"还是"EXE"文件，DOS在调入它们时都要保留256字节来预置一些数据，我们把这256字节称为"程序段前缀"（PSP--Program Segment Prefix），对于一个"COM"文件，由于只有一个段，所以PSP、代码、数据和堆栈都在这个段中，PSP在头部，堆栈在尾部，中间是代码和数据，一个"COM"程序在调入内存执行时DOS会自动在堆栈中存入一个0，所以"COM"程序只需使用近程的RET指令就能返回DOS，并且无需自己初始化堆栈。
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page53.html">上一页</a> <a href="page55.html">下一页</a> <a href="page80.html">下一章</a></p>
</body>
</html>

