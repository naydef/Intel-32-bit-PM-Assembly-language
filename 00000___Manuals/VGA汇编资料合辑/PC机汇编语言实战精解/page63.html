<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<title>第4章 奇妙的声音</title>
</head>

<body>
<style type="text/css">
body {
	background-color: #c0c0c0;
}

table {
	background-color: #c0c0c0;
	line-height: 24px;
}
</style>
<!导航条>
<p><a href="content1.html">目录</a> <a href="page62.html">上一页</a> <a href="page64.html">下一页</a> <a href="page80.html">下一章</a></p>
<table border=0 align="center" width=800 frame="box" rules="none">
<!标尺行>
<tr>
<td width=3%></td><td width=6%></td><td width=1%></td> <!左侧空白>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td><td width=5%></td>
<td width=1%></td><td width=6%></td><td width=3%></td> <!右侧空白>
</tr>

<!页眉行>
<tr height=60 valign="bottom">
<td></td><td></td><td></td>
<td colspan=6><img src="icons/flag.gif"></td><td colspan=4></td><td colspan=6 align="right">第4章 奇妙的声音</td> <!章节名>
<td></td><td>-63-</td><td></td> <!页码>
</tr>
<!页眉线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!正文>
<font face="宋体" lang="ZH-CN" size=3>
<tr height=20><td colspan=22></td></tr> <!顶部空白>

<tr>
<td></td><td></td> <!左边距>
<td colspan=18>
　　请看用方框框住的程序段：程序先将BX寄存器置成0，以BX为指针分别在NOTE表和DL_TIME表内取得音符值和时间值。NOTE[BX]表示NOTE表内的第"BX"个数据，此写法和C语言中数组的表示法类似，其实NOTE本身就是一个"CHAR"类型的数组。<br>
　　取到音符和时间后程序把BX寄存器加1，也就是把数组下标加1，而后将BX和AX保存到堆栈中，因为这两个寄存器下面还要使用。程序用CBW指令将音符值由"字节"转换成"字"并将其拷贝到BX中，然后再以BX为下标在FREQ数组中找到音符对应的N值。将此N值送入定时器，并将定时器和电子开关打开，此时就能听到声音。取得时钟计数值，从堆栈中弹出AX，将AH寄存器中的节拍值转成字，利用前面讲的方法完成延时后关闭定时器通道3，至此一个音符发音结束。<br>
　　下面给出此程序的反汇编形式，注意指令MOV AL，NOTE[BX]被编译成MOV AL，[BX＋0012]，这和我们在第三章中编制的PROG3－A中的用法一样，由于标号NOTE本身就表示数组的起始地址，因此这条指令的源程序也可写成"MOV AL，[BX＋NOTE]。"<br>
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2></td>
<td colspan=16>
C:\ASM\>DEBUG MUSIC.COM[Enter]<br>
-u0 50[Enter]
</td>
<td></td><td></td> <!右边距>
</tr>

<tr>
<td></td><td></td> <!左边距>
<td colspan=2></td>
<td colspan=2>
0A53:0000<br>
0A53:0003<br>
0A53:0005<br>
0A53:0007<br>
0A53:0009<br>
0A53:000C<br>
0A53:0010<br>
0A53:0014<br>
0A53:0015<br>
0A53:0016<br>
0A53:0017<br>
0A53:0018<br>
0A53:001A<br>
0A53:001C<br>
0A53:0020<br>
0A53:0022<br>
0A53:0024<br>
0A53:0026<br>
0A53:0028<br>
0A53:002A<br>
0A53:002C<br>
0A53:002E<br>
0A53:0030<br>
0A53:0031<br>
0A53:0033<br>
0A53:0034
</td>
<td colspan=2>
B84E0A<br>
8ED8<br>
B0B6<br>
E643<br>
BB0000<br>
8A871200<br>
8AA72D00<br>
43<br>
53<br>
50<br>
98<br>
D1E0<br>
8BD8<br>
8B870000<br>
E642<br>
8AC4<br>
E642<br>
E461<br>
0C03<br>
E661<br>
B400<br>
CD1A<br>
58<br>
8AC4<br>
98<br>
03C2
</td>
<td colspan=2>
MOV<br>
MOV<br>
MOV<br>
OUT<br>
MOV<br>
MOV<br>
MOV<br>
INC<br>
PUSH<br>
PUSH<br>
CBW<br>
SHL<br>
MOV<br>
MOV<br>
OUT<br>
MOV<br>
OUT<br>
IN<br>
OR<br>
OUT<br>
MOV<br>
INT<br>
POP<br>
MOV<br>
CBW<br>
ADD
</td>
<td colspan=10>
AX,0A4E<br>
DS,AX<br>
AL,B6<br>
43,AL<br>
BX,0000<br>
AL,[BX+0012]<br>
AH,[BX+002D]<br>
BX<br>
BX<br>
AX<br>
<br>
AX,1<br>
BX,AX<br>
AX,[BX+0000]<br>
42,AL<br>
AL,AH<br>
42,AL<br>
AL,61<br>
AL,03<br>
61,AL<br>
AH,00<br>
1A<br>
AX<br>
AL,AH<br>
<br>
AX,DX
</td>
<td></td><td></td> <!右边距>
</tr>

</font>

<!页脚线>
<tr valign="top">
<td></td><td colspan=20><hr></td><td></td>
</tr>
<!页脚>
<tr height=60 valign="top">
<td></td><td></td>
<td colspan=9><i>Copyright &copy; 2004-2005 <a href="mailto:webmaster@nucstorm.com">Chunk Lee</a></i></td>
<td colspan=9 align="right"><i><a href="http://www.nucstorm.com" target="_top">www.nucstorm.com</a></i></td>
<td></td><td></td>
</tr>
</table>
<!导航条>
<p align="right"><a href="content1.html">目录</a> <a href="page62.html">上一页</a> <a href="page64.html">下一页</a> <a href="page80.html">下一章</a></p>
</body>
</html>

